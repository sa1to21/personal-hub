services:
  frontend:
    image: frontend
    environment:
      - VITE_API_URL=http://auth-service:3000
      - VITE_TASK_API_URL=http://task-service:3000
    build:
      context: ./services/frontend
    ports:
      - "81:80"
    depends_on:
      - auth-service
      - task-service

  auth-service:
    image: auth-service
    environment:
      - DATABASE_URL=postgresql://auth-services:auth123!@auth-db:5432/auth-db
      - JWT_SECRET=your-secret-key-change-in-production
      - JWT_ACCESS_EXPIRATION=15m
      - JWT_REFRESH_EXPIRATION=7d
      - NODE_ENV=development
    build:
      context: ./services/auth-service
    ports:
      - "3002:3000"
    depends_on:
      auth-db:
       condition: service_healthy

  auth-db:
    image: postgres:latest
    environment:
      POSTGRES_USER: auth-services
      POSTGRES_PASSWORD: auth123!
      POSTGRES_DB: auth-db
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U auth-services -d auth-db"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - auth-db-data:/var/lib/postgresql

  task-service:
    image: task-service
    environment:
      - DATABASE_URL=postgresql://task-service:task123!@task-db:5432/task-db
      - JWT_SECRET=your-secret-key-change-in-production
      - JWT_ACCESS_EXPIRATION=15m
      - JWT_REFRESH_EXPIRATION=7d
      - NODE_ENV=development
    build:
      context: ./services/task-service
    ports:
      - "3003:3000"
    depends_on:
      task-db:
       condition: service_healthy

  task-db:
    image: postgres:latest
    environment:
      POSTGRES_USER: task-service
      POSTGRES_PASSWORD: task123!
      POSTGRES_DB: task-db
    ports:
      - "5434:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U task-service -d task-db"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - task-db-data:/var/lib/postgresql

volumes:
  auth-db-data:
  task-db-data: